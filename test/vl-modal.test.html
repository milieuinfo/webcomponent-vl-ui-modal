<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <script type="module" src="../node_modules/vl-ui-button/vl-button.js"></script>
  <script type="module" src="../vl-modal.src.js"></script>
  <script src="../node_modules/sinon/pkg/sinon.js"></script>
</head>

<body>

<test-fixture id="vl-modal-fixture">
  <template>
    <button id="button-1" is="vl-button" data-vl-modal-open="modal-1">Open</button>
    <vl-modal id="modal-1"></vl-modal>
  </template>
</test-fixture>

<test-fixture id="vl-modal-zonder-actions-fixture">
  <template>
    <vl-modal id="modal-2" title="al-een-title" cancellable="false">
    </vl-modal>
  </template>
</test-fixture>

<script>
  suite('<vl-modal>', () => {
    const should = chai.should();

    let modal, modal2, button;

    setup(() => {
      window.vl = {
        modal: {
          dress: sinon.fake(),
          toggle: sinon.fake()
        }
      };
    // });
    //
    // setup(() => {
      let parent = fixture('vl-modal-fixture');
      modal = parent.filter(element => element.id === "modal-1")[0];
      button = parent.filter(element => element.id === "button-1")[0];
    // });
    //
    // setup(() => {
      modal2 = fixture('vl-modal-zonder-actions-fixture');
    });

    test('de dress methode called vl.modal.dress met de dialog', () => {
      modal.dress();
      assert(window.vl.modal.dress.calledWith(modal._dialogElement));
    });

    test('de open methode called vl.modal.toggle met de dialog', () => {
      modal.open();
      assert(window.vl.modal.toggle.calledWith(modal._dialogElement));
      assert(window.vl.modal.lastClickedToggle === modal._dialogElement);
    });

    test('de open methode called niet vl.modal.toggle met de dialog als al open', () => {
      modal.setAttribute('open', '');
      modal.open();
      assert.isFalse(window.vl.modal.toggle.calledWith(modal._dialogElement));
    });

    test('de close methode called vl.modal.toggle met de dialog', () => {
      modal.setAttribute('open', '');
      modal.close();
      assert(window.vl.modal.toggle.calledWith(modal._dialogElement));
    });

    test('de close methode called niet vl.modal.toggle met de dialog als al closed', () => {
      modal.close();
      assert.isFalse(window.vl.modal.toggle.calledWith(modal._dialogElement));
    });

    test('verander de closable attribute van de modal', () => {
      assert.isFalse(modal._dialogElement.hasAttribute('data-vl-modal-closable'));
      should.not.exist(modal._dialogElement.querySelector('.vl-modal-dialog__close'));

      modal.setAttribute('closable', '');

      assert.isTrue(modal._dialogElement.hasAttribute('data-vl-modal-closable'));
      should.exist(modal._dialogElement.querySelector('.vl-modal-dialog__close'));
    });

    test('verander de id attribute van de modal', () => {
      assert.isTrue(modal._dialogElement.id === 'modal-1');
      modal.setAttribute('id', 'modal-new');
      assert.isTrue(modal._dialogElement.id === 'modal-new');
    });

    test('verander de open attribute van de modal', () => {
      assert.isFalse(modal._dialogElement.hasAttribute('open'));
      modal.setAttribute('open', '');
      assert.isTrue(modal._dialogElement.hasAttribute('open'));
    });

    test('verander de cancellable attribute van de modal', () => {
      should.not.exist(modal2._cancelElement);

      modal2.removeAttribute('cancellable');

      should.exist(modal2._cancelElement);
    });

    test('verander de cancellable attribute van de modal twee keer', () => {
      should.not.exist(modal2._cancelElement);

      modal2.removeAttribute('cancellable');

      should.exist(modal2._cancelElement);

      modal2.setAttribute('cancellable', 'false');

      should.not.exist(modal2._cancelElement);
    });

    test('verander de title attribute van de modal', () => {
      assert.isNull(modal._titleElement);

      modal.setAttribute('data-title', 'title');

      assert.isTrue(modal._dialogElement.querySelector('#modal-toggle-1-title').innerText === 'title');
    });

    test('verander de title attribute van de modal als er al een title gedefineerd was', () => {
      assert.isDefined(modal2._titleElement);

      modal2.setAttribute('data-title', 'andere-titel');

      assert.strictEqual(modal2._dialogElement.querySelector('#modal-toggle-1-title').innerText, 'andere-titel');
      assert.strictEqual(modal2._titleElement.innerText, 'andere-titel');
    });

    test('verander de title attribute van de modal terug naar undefined en titleElement wordt leeggemaakt', () => {
      assert.isDefined(modal2._titleElement);

      modal2.setAttribute('data-title', '');

      assert.isNull(modal2._titleElement);
    });

    test('de annuleer knop is beschikbaar als de standaard actions gedefineerd zijn', () => {
      modal._dialogElement.setAttribute('open', '');

      assert.isAbove(modal._element.querySelector('button').offsetHeight, 0);
      assert.isAbove(modal._element.querySelector('button').offsetWidth, 0);
    });

    test('de annuleer knop is niet beschikbaar als cancellable false is', () => {
      modal2._dialogElement.setAttribute('open', '');

      should.not.exist(modal2._element.querySelector('button'));
    });

    test('verander de title attribute van de modal meerdere keren', () => {
      assert.isNull(modal.shadowRoot.querySelector('#modal-toggle-1-title'));

      modal.setAttribute('data-title', 'title');
      assert.equal(modal.shadowRoot.querySelector('#modal-toggle-1-title').innerText, 'title');

      modal.removeAttribute("data-title");
      assert.isNull(modal.shadowRoot.querySelector('#modal-toggle-1-title'));

      modal.setAttribute('data-title', 'title2');
      assert.equal(modal.shadowRoot.querySelector('#modal-toggle-1-title').innerText, 'title2');

      modal.setAttribute('data-title', 'title update3');
      assert.equal(modal.shadowRoot.querySelector('#modal-toggle-1-title').innerText,
          'title update3');

      modal.removeAttribute("data-title");
      assert.isNull(modal.shadowRoot.querySelector('#modal-toggle-1-title'));
    });

  });
</script>
</body>

</html>